<!-- Copilot instructions for piezofabric-web-app -->
# Copilot / AI Agent Instructions

Purpose: quickly orient an AI coding agent to be productive in this React+Vite + AWS Amplify Gen2 template.

- **Big picture**: Frontend is a TypeScript React app built with Vite (`src/`, `index.html`). Backend resources are declared in `amplify/` using Amplify Gen2 helpers (`@aws-amplify/backend`). The frontend reads runtime configuration from `amplify_outputs.json` (imported in `src/main.tsx`) and uses `aws-amplify` and `aws-amplify/data` to talk to the backend.

- **Key files to read first**:
  - `package.json` — scripts and engine requirements (node >= 20, npm >= 10).
  - `src/main.tsx` — bootstraps Amplify with `amplify_outputs.json`.
  - `src/App.tsx` — example use of `generateClient<Schema>()` and `observeQuery()` for real-time data.
  - `amplify/backend.ts` — entry point that composes `auth` and `data` resources.
  - `amplify/data/resource.ts` — canonical Data schema and authorization examples (Todo model).

- **Architecture & data flow (concise)**:
  - Backend models and auth are declared in `amplify/*` using `defineBackend`, `defineData`, and `defineAuth` (Gen2 style).
  - Frontend generates a typed Data client via `generateClient<Schema>()` (see `src/App.tsx`) and calls `client.models.<Model>` for CRUD/observeQuery.
  - Runtime config published by Amplify is expected in `amplify_outputs.json` and loaded in `src/main.tsx` via `Amplify.configure(outputs)`.

- **Developer workflows & commands** (source: `package.json`):
  - Install: `npm ci` or `npm install` (use node >= 20.20.0).
  - Local dev: `npm run dev` (runs `vite`).
  - Build: `npm run build` (runs `tsc && vite build`).
  - Preview production build: `npm run preview`.
  - Lint: `npm run lint` (ESLint + TypeScript rules configured).

- **Amplify-specific notes (observations from code)**:
  - `amplify/` uses Gen2 SDK (`@aws-amplify/backend`). Edit resource files under `amplify/` to modify backend shape (e.g., `amplify/data/resource.ts`).
  - `amplify_outputs.json` is not committed in this repository by default — it is generated by the Amplify deployment/pull process. If missing, the app will fail at runtime during `Amplify.configure(outputs)` in `src/main.tsx`.
  - Data authorization example: `allow.publicApiKey()` is used in `amplify/data/resource.ts`, and `authorizationModes` sets an API key with 30-day expiry — expect client access patterns to reflect that.

- **Project-specific patterns and conventions**:
  - Prefer the typed `Schema` exported from `amplify/data/resource.ts` when generating clients in frontend files (example: `import type { Schema } from "../amplify/data/resource";`).
  - Use `generateClient<Schema>()` for all Data access — it yields typed `client.models.<Model>` objects used throughout `src/`.
  - Real-time reads use `observeQuery().subscribe(...)` (see `src/App.tsx`) instead of manual polling.
  - Codebase is TS-first: respect TypeScript types and the `tsc` build step in `npm run build`.

- **Editing or adding a model** (concrete example):
  1. Modify `amplify/data/resource.ts` schema (add model/field and auth rules).
  2. Run the Amplify/gen2 backend generation/push workflow (this repo expects Amplify tooling to generate runtime outputs).
  3. In frontend, `import type { Schema } from "../amplify/data/resource"` and regenerate client usage with `generateClient<Schema>()`.

- **What an AI should not assume**:
  - `amplify_outputs.json` and other generated files are not present in the repo — do not hardcode values; prefer editing `amplify/*` resource files or instruct the user to run Amplify CLI steps.
  - Do not change Amplify Gen2 patterns to Gen1 tooling; follow the `@aws-amplify/backend` patterns visible in `amplify/`.

- **Troubleshooting tips (quick checks)**:
  - If app crashes on start, check `src/main.tsx` import of `../amplify_outputs.json` — missing file is likely root cause.
  - For data access issues, verify `amplify/data/resource.ts` authorization rules (apiKey vs authenticated).
  - For type errors, run `npm run build` to surface `tsc` errors.

If anything in these instructions is unclear or you want more detail about the Amplify workflow (CLI commands to produce `amplify_outputs.json` or the intended CI steps), tell me which area to expand and I will iterate.
